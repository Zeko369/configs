#!/bin/bash
# Sync configs to applications that don't support symlinks
# Usage: ./sync [target]
#   ./sync cursor   - Sync Cursor/VSCode settings
#   ./sync all      - Sync everything (default)

set -e

CONFIGS_DIR="$(cd "$(dirname "$0")" && pwd)"

RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m'

info() { echo -e "${GREEN}[SYNC]${NC} $1"; }
warn() { echo -e "${YELLOW}[WARN]${NC} $1"; }

# Detect OS
case "$(uname -s)" in
  Darwin) OS="macos" ;;
  Linux)  OS="linux" ;;
  *)      OS="unknown" ;;
esac

sync_cursor() {
  info "Syncing Cursor/VSCode configs..."

  if [ "$OS" = "macos" ]; then
    CURSOR_DIR="$HOME/Library/Application Support/Cursor/User"
    CURSOR_NIGHTLY_DIR="$HOME/Library/Application Support/Cursor Nightly/User"
    VSCODE_DIR="$HOME/Library/Application Support/Code/User"
  else
    CURSOR_DIR="$HOME/.config/Cursor/User"
    VSCODE_DIR="$HOME/.config/Code/User"
  fi

  # Sync to Cursor
  if [ -d "$CURSOR_DIR" ]; then
    cp "$CONFIGS_DIR/vscode/settings.json" "$CURSOR_DIR/settings.json"
    cp "$CONFIGS_DIR/vscode/keybindings.json" "$CURSOR_DIR/keybindings.json"
    info "  → Cursor: synced"
  else
    warn "  → Cursor: not installed"
  fi

  # Sync to Cursor Nightly (macOS)
  if [ -d "$CURSOR_NIGHTLY_DIR" ]; then
    cp "$CONFIGS_DIR/vscode/settings.json" "$CURSOR_NIGHTLY_DIR/settings.json"
    cp "$CONFIGS_DIR/vscode/keybindings.json" "$CURSOR_NIGHTLY_DIR/keybindings.json"
    info "  → Cursor Nightly: synced"
  fi

  # Sync to VSCode
  if [ -d "$VSCODE_DIR" ]; then
    cp "$CONFIGS_DIR/vscode/settings.json" "$VSCODE_DIR/settings.json"
    cp "$CONFIGS_DIR/vscode/keybindings.json" "$VSCODE_DIR/keybindings.json"
    info "  → VSCode: synced"
  else
    warn "  → VSCode: not installed"
  fi
}

sync_all() {
  sync_cursor
  # Add more sync targets here as needed
  # sync_something_else
}

# Main
case "${1:-all}" in
  cursor|vscode)
    sync_cursor
    ;;
  all)
    sync_all
    ;;
  *)
    echo "Usage: $0 [cursor|all]"
    exit 1
    ;;
esac

echo ""
info "Sync complete!"
